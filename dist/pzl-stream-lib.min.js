import*as e from"@microsoft/signalr";var n={456(e){e.exports=function(){var e=Object.prototype.toString,n=function(){function e(e){this.name="InvalidStateError",this.message=e}return e.prototype=new Error,e.prototype.constructor=e,e}();function t(t,o){if("function"==typeof t&&(t=t()),"[object Object]"!==e.call(t))throw new n("Stately.js: Invalid states object: `"+t+"`.");function r(e,n){for(var t in i[e])if(i[e].hasOwnProperty(t)&&t.toLowerCase()===n.toLowerCase())return i[e][t]}var c,i={getMachineState:function(){return c.name},setMachineState:function e(t){var o,s,a=arguments[1],u=c;if("string"==typeof t&&(t=i[t]),!t||!t.name||!i[t.name])throw new n("Stately.js: Transitioned into invalid state: `"+e.caller+"`.");return c=t,(s=r(u.name,"onLeave"))&&"function"==typeof s&&s.call(i,a,u.name,c.name),(o=r(c.name,"onEnter"))&&"function"==typeof o&&o.call(i,a,u.name,t.name),this},getMachineEvents:function(){var e=[];for(var n in c)c.hasOwnProperty(n)&&"function"==typeof c[n]&&e.push(n);return e}},s={getMachineState:i.getMachineState,getMachineEvents:i.getMachineEvents},a=function(n,t,o){return function(){var a,u,l,d=s;return i[n]!==c?(o&&(d=o.apply(i,arguments)),d):((a=r(c.name,"onBefore"+t))&&"function"==typeof a&&a.call(i,t,c.name,c.name),void 0===(d=i[n][t].apply(i,arguments))?(l=c,d=s):"string"==typeof d?(l=i[d],d=s):"[object Object]"===e.call(d)?(l=d===i?c:d,d=s):"[object Array]"===e.call(d)&&d.length>=1&&(l="string"==typeof d[0]?i[d[0]]:d[0],d=d[1]),(u=r(c.name,"onAfter"+t))&&"function"==typeof u&&u.call(i,t,c.name,l.name),i.setMachineState(l,t),d)}};for(var u in t)if(t.hasOwnProperty(u)){for(var l in i[u]=t[u],i[u])i[u].hasOwnProperty(l)&&("string"==typeof i[u][l]&&(i[u][l]=function(e){return function(){return this[e]}}(i[u][l])),"function"!=typeof i[u][l]||/^onEnter$/i.test(l)||/^onLeave$/i.test(l)||/^onBefore/i.test(l)||/^onAfter/i.test(l)||(s[l]=a(u,l,s[l])));i[u].name=u,c||(c=i[u])}if(void 0!==i[o]&&(c=i[o]),!c)throw new n("Stately.js: Invalid initial state.");return s}return t.machine=function(e,n){return new t(e,n)},t.InvalidStateError=n,t}()}},t={};function o(e){var r=t[e];if(void 0!==r)return r.exports;var c=t[e]={exports:{}};return n[e].call(c.exports,c,c.exports,o),c.exports}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function c(e){var n=function(e,n){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,n||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==r(n)?n:n+""}function i(e,n,t){return(n=c(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}o.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return o.d(n,{a:n}),n},o.d=(e,n)=>{for(var t in n)o.o(n,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},o.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);const s=e;var a=o(456),u=o.n(a);const l=e=>new Promise(function(n){return setTimeout(n,e)}),d=(e,n,t,o)=>new Promise(function(r,c){return e().then(r).catch(function(i){return t-1>0&&i!==o?l(n).then(d.bind(null,e,n,t-1,o)).then(r).catch(c):c(i)})}),f=function(){const e=e=>e&&"object"==typeof e;for(var n=arguments.length,t=new Array(n),o=0;o<n;o++)t[o]=arguments[o];return t.reduce(function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return e(t)?(Object.keys(t).forEach(o=>{const r=n[o],c=t[o];Array.isArray(c)&&Array.isArray(r)?n[o]=[...new Set([...c,...r])]:e(c)&&e(r)?n[o]=f(r,c):e(r)?n[o]=c:n=t}),n):t},{})},b=e=>{try{if("undefined"!=typeof localStorage)return localStorage.getItem(e)}catch(e){}},p={debugDisabled:!0,log:()=>{},warn:()=>{},error:()=>{},info:()=>{}};const v=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;t=t||p,t.log("initBrokerConnectionFsm");const o={fsm:null,connection:null,reconnectCounter:0,eventListeners:{},brokerEventCallbacks:n},r=function(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return o.fsm[e](...t)},c=(e,n)=>{o.eventListeners[e]=(o.eventListeners[e]||[]).filter(e=>n&&e!==n)},i={disconnected:{_onEnter:function(){t.log("FSM: disconnected._onEnter()"),o.connection=null},connect:function(){return this.connecting}},connecting:{_onEnter:function(){t.log("FSM: connecting._onEnter()"),e._connect()},connection_ok:function(e){return o.connection=e,this.connected},connection_failed:function(e){return this.disconnected},disconnect:function(){return this.disconnecting}},connected:{_onEnter:function(n,r){var c;t.log("FSM: connected._onEnter()",n,r),"reconnecting"===r&&e.reSubscribeAll(),"function"==typeof(null==o||null===(c=o.brokerEventCallbacks)||void 0===c?void 0:c.onConnectionStarted)&&o.brokerEventCallbacks.onConnectionStarted(o.connection)},connection_failed:function(){var e;return"function"==typeof(null==o||null===(e=o.brokerEventCallbacks)||void 0===e?void 0:e.onConnectionFailed)&&o.brokerEventCallbacks.onConnectionFailed("connection failed"),o.connection=null,o.reconnectCounter=0,this.reconnect_wait},disconnect:function(){return this.disconnecting}},reconnect_wait:{_onEnter:function(){t.log("FSM: reconnect_wait._onEnter()"),o.reconnectCounter<12?r("schedule_reconnect"):r("reconnection_failed")},schedule_reconnect:function(){t.log("FSM reconnect_wait.schedule_reconnect(): Reconnecting to broker in 10 sec..."),clearTimeout(o.reconnectTimer),o.reconnectTimer=setTimeout(function(){r("connect")}.bind(this),1e4)},connect:function(){return this.reconnecting},disconnect:function(){return this.disconnecting},reconnection_failed:function(){return this.disconnected},_onExit:function(){clearTimeout(o.reconnectTimer)}},reconnecting:{_onEnter:function(){t.log("FSM: reconnecting._onEnter()"),o.reconnectCounter++,e._connect()},connection_ok:function(e){return o.connection=e,this.connected},connection_failed:function(e){var n;return"function"==typeof(null==o||null===(n=o.brokerEventCallbacks)||void 0===n?void 0:n.onConnectionFailed)&&o.brokerEventCallbacks.onConnectionFailed(e),this.reconnect_wait},disconnect:function(){return this.disconnecting}},disconnecting:{_onEnter:function(){t.log("FSM: disconnecting._onEnter()",this),e.unSubscribeAll(),o.connection?o.connection.stop().catch(()=>{}).finally(()=>{r("disconnect_ok")}):r("disconnect_ok")},disconnect_ok:function(){var e;return"function"==typeof(null==o||null===(e=o.brokerEventCallbacks)||void 0===e?void 0:e.onDisconnected)&&o.brokerEventCallbacks.onDisconnected(),this.disconnected}}};return Object.keys(i).forEach(function(e){const n=i[e].onEnter;i[e].onEnter=function(e,t,r){let c=null;t!==r&&("function"==typeof i[t]._onExit&&i[t]._onExit.call(this,e,t,r),function(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];(o.eventListeners[e]||[]).forEach(function(e){e.call(this,...t)}.bind(void 0))}("transition",{fromState:t,toState:r}),"function"==typeof i[r]._onEnter&&(c=i[r]._onEnter.call(this,e,t,r))),"function"==typeof n&&n.call(this,e,t,r),c&&this.setMachineState(c,"_onEnter")}}),o.fsm=new(u())(i,"disconnected"),{handle:r,on:(e,n)=>(o.eventListeners[e]=(o.eventListeners[e]||[]).concat(n),{eventName:e,callback:n,off:()=>{c(e,n)}}),off:c,getState:()=>o.fsm.getMachineState(),getConnection:()=>o.connection,setEventCallbacks:e=>o.brokerEventCallbacks=e}},g={STATE:"state",STREAM:"stream",STREAMED_CHUNK:"chunk"},S={BROKER_DISCONNECTED:0,BROKER_CONNECT_ERROR:1,BROKER_RECONNECT_ATTEMPT_ERROR:2,BROKER_RECONNECT_FATAL_ERROR:3,BROKER_INVALID_CONNECTION_ERROR:4,TOPIC_GET_ERROR:5,TOPIC_SUBSCRIBE_ERROR:6,TOPIC_STREAM_OUT_OF_ORDER:7};function h(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function E(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?h(Object(t),!0).forEach(function(n){i(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}const m=(e,n,t)=>{const o=n.options.getMethod||"Get",[r,c]=n[n.options.topicProperty].split("::").reverse();return e.stream(o,E({type:c,[n.options.topicProperty]:r,skip:Math.max(0,t-1)||void 0},n.extraProps||{}))},y=function(e,n,t){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r=n.options.getReverseMethod||"GetReverse",[c,i]=n[n.options.topicProperty].split("::").reverse();return e.stream(r,E({type:i,[n.options.topicProperty]:c,skip:Math.max(0,o)||void 0,take:t},n.extraProps||{}))},k=(e,n,t)=>{const o=n.options.streamMethod||"Subscribe",[r,c]=n[n.options.topicProperty].split("::").reverse();return e.stream(o,E({type:c,[n.options.topicProperty]:r,skip:Math.max(0,t-1)||void 0},n.extraProps||{}))},R=function(e,n,t,o){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const c=o.publishMethod||"Publish";return e.invoke(c,E({topic:n,data:t},r))};let _=[];const O=e=>e&&_.find(n=>n.getSubscriptionId()===e.getSubscriptionId())||null,T=()=>_,I=e=>!(!e||"object"!=typeof e)&&(_=_.filter(n=>n.getSubscriptionId()!==e.getSubscriptionId()),!0);function w(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function C(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?w(Object(t),!0).forEach(function(n){i(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}let A=p,P={publishMethod:"Publish",brokerUrl:null,brokerTransport:"WebSockets",brokerLogLevel:"none"},M=0,j=null;function D(){let e;switch(A.log("_connect: Connecting to broker url: "+P.brokerUrl),P.brokerTransport){case"None":case"Negotiate":e={};break;case"LongPolling":e={transport:s.HttpTransportType.LongPolling};break;case"ServerSentEvents":e={transport:s.HttpTransportType.ServerSentEvents};break;default:e={skipNegotiation:!0,transport:s.HttpTransportType.WebSockets}}e.accessTokenFactory=P.accessTokenFactory||P.access_token&&(()=>P.access_token)||null;const n=(new s.HubConnectionBuilder).withUrl(P.brokerUrl,e).configureLogging(P.brokerLogLevel).withAutomaticReconnect(P.reconnectRetryPolicy||[0,500,3e3,5e3,1e4]).build();n.onreconnecting(e=>{var t;A.warn("_connect: Broker connection onreconnecting:",e,n.connectionState,n.receivedHandshakeResponse),"function"==typeof(null===(t=P.brokerEventHandlers)||void 0===t?void 0:t.onReconnecting)&&P.brokerEventHandlers.onReconnecting(e),G()}),n.onreconnected(async e=>{var t;A.warn("_connect: Broker connection onreconnected:",n.connectionState,n.receivedHandshakeResponse),"function"==typeof(null===(t=P.brokerEventHandlers)||void 0===t?void 0:t.onReconnected)&&P.brokerEventHandlers.onReconnected(e),await U()}),n.onclose(e=>{A.log("_connect: Broker connection closed:",e,n.connectionState,n.receivedHandshakeResponse),j.handle("connection_failed")}),n.start().then(()=>{A.log("_connect: Broker connection.start() successful:",n,n.connectionState,n.receivedHandshakeResponse),j.handle("connection_ok",n)},e=>{A.log("_connect: Broker connection.start() error: ",e,n,n.connectionState),j.handle("connection_failed",e)})}function x(){return j&&"connected"===j.getState()}function L(){return!j||"disconnected"===j.getState()}function N(){return new Promise(function(e,n){if(x())e(j.getConnection());else{const t=j.on("transition",function(o){"connected"===o.toState?(e(j.getConnection()),t.off()):"disconnected"!==o.toState&&"reconnect_wait"!==o.toState||(n(),t.off())});j.handle("connect")}})}function B(){return new Promise(function(e,n){if(L())e();else{const n=j.on("transition",function(t){"disconnected"===t.toState&&(e(),n.off())});j.handle("disconnect")}})}function F(){return B().then(function(){return N().then(function(e){return U().then(function(e){A.log("reConnectToBroker: all topics re-subscribed:",e)}),Promise.resolve(e)})})}function H(){return N()}function U(){var e=[];return T().forEach(n=>{A.log("reSubscribeAll: Re-subscribing to subscription: ",n),e.push(K(n,!0).catch(e=>{A.warn('reSubscribeAll: Error re-subscribing to subscription: "'+n+'"',e)}))}),Promise.all(e)}function G(){T().forEach(W)}function K(e,n){return n?d(z.bind(null,e),1e3,60,"abort"):z(e)}function z(e){return A.log("_getAndStreamSubscription:",e),new Promise(function(n,t){if(W(e),!(e=O(e)))return t("abort");var o=++M;e.subscribeInvocationId=o,A.log("_getAndStreamSubscription currentSubscribeInvocationId:",o),H().then(function(r){if(A.log("_getAndStreamSubscription: gotConnection:",r),(e=O(e)).subscribeInvocationId!==o)return A.log("_getAndStreamSubscription: A newer subscription has been invoked while waiting for connection - abort this one..."),t("abort");e.subscriberRef&&W(e);var c,i=e.lastReceivedEventId<0&&("number"!=typeof e.fromEventId||e.fromEventId===e.options.topicStartEventId),s=i?e.options.topicStartEventId:e.lastReceivedEventId>=0?e.lastReceivedEventId+1:e.fromEventId;const a="boolean"==typeof e.streamingSubscribeOnly?e.streamingSubscribeOnly:P.streamingSubscribeOnly,u="boolean"==typeof e.streamingSubscribeOnResume?e.streamingSubscribeOnResume:P.streamingSubscribeOnResume;a||u&&!i?c=Promise.resolve([]):(A.log("_getAndStreamSubscription: 'Get': ",e," from: ",s,"invocationId:",o),c=function(e,n,t){return new Promise(function(o,r){const c=[],i=t<0,s={next:function(e){c.push(e)},complete:function(){o(i?c.reverse():c)},error:function(e){A.error("getTopic(): Get stream error:",e),r(e)}};i?y(e,n,-t).subscribe(s):m(e,n,t).subscribe(s)})}(r,e,s)),c.then(function(c){if((e=O(e)).subscribeInvocationId!==o)return A.log("_getAndStreamSubscription: A newer subscription to this topic has been invoked while waiting for getTopic() - abort this one..."),t("abort");if(c&&Array.isArray(c)&&c.length){A.log("_getAndStreamSubscription: Got topic eventsArray:",c,"invocationId:",o);try{var a=V(c=c.filter(function(n){const t=n[e.options.eventIdProperty];if(t<e.lastReceivedEventId+1)return A.error("Error: Broker event id in response-array from 'Get' out of order (old event received). Expected "+(e.lastReceivedEventId+1)+", received "+t,n,"invocationId:",o),A.log("Skipping event..."),!1;if(-1!=e.lastReceivedEventId&&t>e.lastReceivedEventId+1)throw A.error("Error: Broker event id in response-array from 'Get' out of order (gap - event(s) missing). Expected "+(e.lastReceivedEventId+1)+", received "+t,n,"invocationId:",o),S.TOPIC_STREAM_OUT_OF_ORDER;return e.lastReceivedEventId=t,!0}),i?g.STATE:g.STREAMED_CHUNK,"invocationId: "+o);e.onDataReceived(a.eventsArray,a.receivedAs)}catch(o){return o===S.TOPIC_STREAM_OUT_OF_ORDER?A.log("Unrecoverable error: Re-subscribing to topic..."):A.log("Unknown error:",o),void K(e).then(n,t)}s=e.lastReceivedEventId+1}try{A.log("_getAndStreamSubscription: 'Subscribe': ",e," from id: ",s,"invocationId:",o),e.subscriberRef=k(r,e,s,P).subscribe({next:function(n){const t=n[e.options.eventIdProperty];if(t<e.lastReceivedEventId+1)A.error("Error: Broker event id in 'Subscribe'-stream out of order (old event received). Expected "+(e.lastReceivedEventId+1)+", received "+t,n,"invocationId:",o),A.log("Skipping event...");else if(-1!=e.lastReceivedEventId&&t>e.lastReceivedEventId+1)A.error("Error: Broker event id in 'Subscribe'-stream out of order: (gap - event(s) missing). Expected "+(e.lastReceivedEventId+1)+", received "+t,n,"invocationId:",o),A.log("Re-subscribing to topic..."),K(e,!0).catch(function(e){A.log("Error resubscribing to topic (subscribe, stream out of order, gap)",e)});else{const r=V(n,g.STREAM,"invocationId: "+o);e.onDataReceived(r.eventsArray,r.receivedAs),e.lastReceivedEventId=t}},complete:function(){A.log('Stream completed on "'+e+'"',"invocationId:",o),e.onSubscriptionStreamComplete&&e.onSubscriptionStreamComplete()},error:function(n){A.error('Stream error on "'+e+'":',n,r,r.connectionState,"invocationId:",o),e.onSubscriptionError&&e.onSubscriptionError(n)}}),e.onSubscriptionStart&&e.onSubscriptionStart(),n(e.subscriberRef)}catch(n){A.error('Exception subscribing to topic "'+e+'":',n,"invocationId:",o,r,r.connectionState),t({errorCode:S.TOPIC_SUBSCRIBE_ERROR,errorMessage:"Error subscribing to topic: "+e,err:n})}}).catch(function(n){A.error('_getAndStreamSubscription: Exception from getTopic("'+e+'"):',n,"invocationId:",o,r,r&&r.connectionState),t({errorCode:S.TOPIC_GET_ERROR,errorMessage:"Error getting topic: "+e,err:n})})},function(n){A.error('_getAndStreamSubscription: Exception from getConnection("'+e+'"):',n,"invocationId:",o),t({errorCode:S.BROKER_CONNECT_ERROR,errorMessage:"Could not connect to broker (from _getAndStreamSubscription)",err:n})})})}function W(e){if((e=O(e))&&e.subscriberRef){e.onSubscriptionEnd&&e.onSubscriptionEnd();try{e.subscriberRef.dispose(),A.log("topic subscriber disposed")}catch(e){A.log("Exception disposing topic subscriber:",e)}e.subscriberRef=null}}function V(e,n,t){if(A&&!A.debugDisabled){const o=[];if(n===g.STREAM){const n=e.data&&e.data.type||e.type,t=e.data&&e.data.messageType||e.messageType;o.push("conversationData STREAM-event:",n+("conversationMessage"===n?" ("+t+")":""))}else n===g.STREAMED_CHUNK?o.push("conversationData STREAMED_CHUNK-array:"):n===g.STATE?o.push("conversationData STATE-array:"):o.push("conversationData (receivedAs = unknown)):");o.push(e,t),A.log.apply(null,o)}return{eventsArray:n===g.STREAM?[e]:e,receivedAs:n}}const $={_signalr:s,init:async function(e){var n;let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const c="true"===b("pzl-streaming-debug");A=c&&console||r||p;const i=b("pzl-broker-log-level")||c&&"info"||null;if(j||(j=v({_connect:D,reSubscribeAll:U,unSubscribeAll:G},o,A)),t.brokerTransport=t.brokerTransport||"WebSockets",t.brokerLogLevel=i||t.brokerLogLevel||"none",t.streamingSubscribeOnly=!!t.streamingSubscribeOnly||!1,t.streamingSubscribeOnResume=!1!==t.streamingSubscribeOnResume,t.access_token=t.access_token||await(null===(n=t.accessTokenFactory)||void 0===n?void 0:n.call(t))||null,!(e&&e!==P.brokerUrl||t.access_token!==P.access_token||t.brokerTransport!==P.brokerTransport||t.brokerLogLevel!==P.brokerLogLevel))return"no change";if(P=C(C(C({},P),{},{brokerUrl:e},t),{},{brokerEventHandlers:o}),j.setEventCallbacks(o),A.log("Initializing StreamConnector"),A.log("SignalR client lib version:",s.VERSION),L())return"disconnected";try{const e=await F();return A.log("StreamConnector: broker config changed: Successfully re-connected to broker",e),"re-connected"}catch(e){throw A.error("StreamConnector: broker config changed: Error re-connecting to broker",e),"Error re-connecting"}},updateAccessToken:async e=>{var n,t;if(!j)throw new Error("StreamConnection not initialized. This function can only be called after init");if((e=e||await(null===(n=(t=P).accessTokenFactory)||void 0===n?void 0:n.call(t))||null)!==P.access_token){if(P.access_token=e,A.log("StreamConnector.updateAccessToken(): new access_token"),!L())try{const e=await F();return A.log("StreamConnector.updateAccessToken(): Successfully re-connected to broker",e),"re-connected"}catch(e){throw A.error("StreamConnector.updateAccessToken(): Error re-connecting to broker",e),"Error re-connecting"}}else A.log("StreamConnector.updateAccessToken(): access_token not changed => Do nothing")},getStreamSubscriptions:function(){return T()},addStreamSubscription:function(e,n){return A.log("addStreamSubscription:",e,n),W(e),(e=>{I(O(e)),_.push(e)})(e),n?(t=K(e),o=n,Promise.race([t,new Promise(function(e,n){l(o).then(n.bind(null,new Error("timeout")))})])):K(e);var t,o},removeStreamSubscription:function(e){var n;A.log("removeStreamSubscription:",e),"string"==typeof e&&(e=(n=e)&&_.find(e=>e.getSubscriptionId()===n)||null),e&&(W(e),I(e)),T().length<1&&(A.log("No more subscriptions - disconnecting from broker"),B())},publishTopicIfConnected:function(e,n){return x()?function(e,n){return H().then(function(t){try{return R(t,e,n,P)}catch(e){return A.log("Exception in publishTopic: ",e),Promise.reject(e)}})}(e,n):Promise.reject("Not connected")}};class q{constructor(){this.options={topicProperty:"topic",topicStartEventId:1,eventIdProperty:"id",getMethod:"Get",streamMethod:"Subscribe"},this.topic="",this.fromEventId=null,this.subscribeInvocationId=-1,this.subscriberRef=null,this.lastReceivedEventId=-1,this.onDataReceived=function(){},this.onSubscriptionStart=null,this.onSubscriptionEnd=null,this.getSubscriptionId=function(){return this[this.options.topicProperty]},this.toString=function(){return this.getSubscriptionId()}}}const J=class extends q{constructor(e){super();for(const[n,t]of Object.entries(e))this[n]=f(this[n],t)}};export{$ as StreamConnector,S as StreamErrors,g as StreamEventTypes,J as StreamSubscription};