!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("vngageStreamLib",[],e):"object"==typeof exports?exports.vngageStreamLib=e():t.vngageStreamLib=e()}(this,(function(){return function(){var t={643:function(t,e,n){var r;void 0===(r=function(t){"use strict";var e=n(279),r=n(117),o=n(690),i=n(215),c=null,s=function(){},a={log:s,warn:s,error:s,info:s},u=a,h={brokerUrl:null,brokerTransport:"WebSockets",brokerLogLevel:"none"},l={},f={},d=0,p=null;function v(){var t;switch(u.log("_connect: Connecting to broker url: "+h.brokerUrl),h.brokerTransport){case"None":case"Negotiate":t=null;break;case"LongPolling":t={transport:e.HttpTransportType.LongPolling};break;case"ServerSentEvents":t={transport:e.HttpTransportType.ServerSentEvents};break;default:t={skipNegotiation:!0,transport:e.HttpTransportType.WebSockets}}var n=(new e.HubConnectionBuilder).withUrl(h.brokerUrl,t).configureLogging(h.brokerLogLevel).withAutomaticReconnect([0,500,3e3,5e3,1e4]).build();n.onreconnecting((function(t){u.warn("_connect: Broker connection onreconnecting:",t,n.connectionState,n.receivedHandshakeResponse),k()})),n.onreconnected((function(){u.warn("_connect: Broker connection onreconnected:",n.connectionState,n.receivedHandshakeResponse),w()})),n.onclose((function(t){u.log("_connect: Broker connection closed:",t,n.connectionState,n.receivedHandshakeResponse),p.handle("connection_failed")})),n.start().then((function(){u.log("_connect: Broker connection.start() successful:",n,n.connectionState,n.receivedHandshakeResponse),l&&"function"==typeof l.onConnectionStarted&&l.onConnectionStarted(n),p.handle("connection_ok",n)}),(function(t){u.log("_connect: Broker connection.start() error: ",t,n,n.connectionState),p.handle("connection_failed",t)}))}function g(){return"connected"===p.state}function b(){return new Promise((function(t,e){if(g())t(p.connection);else{var n=p.on("transition",(function(r){"connected"===r.toState?(t(p.connection),n.off()):"disconnected"!==r.toState&&"reconnect_wait"!==r.toState||(e(),n.off())}));p.handle("connect")}}))}function y(){return new Promise((function(t,e){"disconnected"===p.state&&t();var n=p.on("transition",(function(e){"disconnected"===e.toState&&(t(),n.off())}));p.handle("disconnect")}))}function m(){return b()}function w(){var t=[];return Object.keys(f).forEach((function(e){u.log("reSubscribeAll: Re-subscribing to topic: ",e),t.push(E(e,!0).catch((function(t){u.warn('reSubscribeAll: Error re-subscribing to topic: "'+e+'"',t)})))})),Promise.all(t)}function k(){Object.keys(f).forEach((function(t){C(t)}))}function E(t,e){return e?o.retryPromiseFunc(S.bind(null,t),1e3,60,"abort"):S(t)}function S(t){return u.log("_getAndSubscribeToTopic:",t),new Promise((function(e,n){C(t);var o=f[t];if(!o)return n("abort");var c=++d;o.subscribeInvocationId=c,u.log("_getAndSubscribeToTopic currentSubscribeInvocationId:",c),m().then((function(s){if(u.log("_getAndSubscribeToTopic: gotConnection:",s),(o=f[t]).subscribeInvocationId!==c)return u.log("_getAndSubscribeToTopic: A newer subscription to this topic has been invoked while waiting for connection - abort this one..."),n("abort");o.subscriberRef&&C(t);var a,l=o.lastReceivedEventId<0&&("number"!=typeof o.fromEventId||1===o.fromEventId),d=l?1:o.lastReceivedEventId>=0?o.lastReceivedEventId+1:o.fromEventId;h.streamingSubscribeOnly?a=Promise.resolve([]):(u.log("_getAndSubscribeToTopic: 'Get' topic: ",t," from: ",d,"invocationId:",c),a=function(t,e,n){var r=[];return new Promise((function(o,i){t.stream("Get",e,n).subscribe({next:function(t){r.push(t)},complete:function(){o(r)},error:function(r){u.error("getTopic(): Get stream error:",r),r&&"string"==typeof r.message&&-1!==r.message.indexOf("HubException: Unauthorized")?i(r):(u.log("getTopic(): Retrying with connection.invoke('Get', topic, fromId)"),t.invoke("Get",e,n).then(o,i))}})}))}(s,o.topic,d)),a.then((function(a){if((o=f[t]).subscribeInvocationId!==c)return u.log("_getAndSubscribeToTopic: A newer subscription to this topic has been invoked while waiting for getTopic() - abort this one..."),n("abort");if(a&&Array.isArray(a)&&a.length){u.log("_getAndSubscribeToTopic: Got topic eventsArray:",a,"invocationId:",c);try{var h=T(a=a.filter((function(t){if(t.id<o.lastReceivedEventId+1)return u.error("Error: Broker event id in response-array from 'Get' out of order (old event received). Expected "+(o.lastReceivedEventId+1)+", received "+t.id,t,"invocationId:",c),u.log("Skipping event..."),!1;if(-1!=o.lastReceivedEventId&&t.id>o.lastReceivedEventId+1)throw u.error("Error: Broker event id in response-array from 'Get' out of order (gap - event(s) missing). Expected "+(o.lastReceivedEventId+1)+", received "+t.id,t,"invocationId:",c),r.TOPIC_STREAM_OUT_OF_ORDER;return o.lastReceivedEventId=t.id,!0})),l?i.STATE:i.STREAMED_CHUNK,"invocationId: "+c);o.onDataReceived(h.eventsArray,h.receivedAs)}catch(o){return o===r.TOPIC_STREAM_OUT_OF_ORDER?u.log("Unrecoverable error: Re-subscribing to topic..."):u.log("Unknown error:",o),void E(t).then(e,n)}d=o.lastReceivedEventId+1}try{u.log("_getAndSubscribeToTopic: 'Subscribe' to topic: ",t," from id: ",d,"invocationId:",c),o.subscriberRef=s.stream("Subscribe",t,d).subscribe({next:function(e){if(e.id<o.lastReceivedEventId+1)return u.error("Error: Broker event id in 'Subscribe'-stream out of order (old event received). Expected "+(o.lastReceivedEventId+1)+", received "+e.id,e,"invocationId:",c),void u.log("Skipping event...");if(-1!=o.lastReceivedEventId&&e.id>o.lastReceivedEventId+1)return u.error("Error: Broker event id in 'Subscribe'-stream out of order: (gap - event(s) missing). Expected "+(o.lastReceivedEventId+1)+", received "+e.id,e,"invocationId:",c),u.log("Re-subscribing to topic..."),void E(t,!0).catch((function(t){u.log("Error resubscribing to topic (subscribe, stream out of order, gap)",t)}));var n=T(e,i.STREAM,"invocationId: "+c);o.onDataReceived(n.eventsArray,n.receivedAs),o.lastReceivedEventId=e.id},complete:function(){u.log('Stream completed on topic "'+t+'"',"invocationId:",c)},error:function(e){u.error('Stream error on topic "'+t+'":',e,s,s.connectionState,"invocationId:",c),u.log("SignalR v3: Do nothing (let auto-reconnect take care of business)")}}),o.onSubscriptionStart&&o.onSubscriptionStart(),e(o.subscriberRef)}catch(e){u.error('Exception subscribing to topic "'+t+'":',e,"invocationId:",c,s,s.connectionState),n({errorCode:r.TOPIC_SUBSCRIBE_ERROR,errorMessage:"Error subscribing to topic: "+t,err:e})}})).catch((function(t){u.error('_getAndSubscribeToTopic: Exception from getTopic("'+o.topic+'"):',t,"invocationId:",c,s,s.connectionState),n({errorCode:r.TOPIC_GET_ERROR,errorMessage:"Error getting topic: "+o.topic,err:t})}))}),(function(t){u.error('_getAndSubscribeToTopic: Exception from getConnection("'+o.topic+'"):',t,"invocationId:",c),n({errorCode:r.BROKER_CONNECT_ERROR,errorMessage:"Could not connect to broker (from _getAndSubscribeToTopic)",err:t})}))}))}function C(t){var e=f[t];if(e&&e.subscriberRef){u.log("unsubscribeToTopic:",t),e.onSubscriptionEnd&&e.onSubscriptionEnd();try{e.subscriberRef.dispose(),u.log("topic subscriber disposed")}catch(t){u.log("Exception disposing topic subscriber:",t)}e.subscriberRef=null}}function T(t,e,n){var r=[];return e===i.STREAM?r.push("conversationData STREAM-event:",t.data.type+("conversationMessage"===t.data.type?" ("+t.data.messageType+")":"")):e===i.STREAMED_CHUNK?r.push("conversationData STREAMED_CHUNK-array:"):e===i.STATE?r.push("conversationData STATE-array:"):r.push("conversationData (receivedAs = unknown)):"),r.push(t,n),u.log.apply(null,r),{eventsArray:e===i.STREAM?[t]:t,receivedAs:e}}return{_signalr:e,init:function(t,n,r,o,i){c||function(t){p=new t.Fsm({initialize:function(){this.connection=null,this.reconnectCounter=0},initialState:"disconnected",states:{disconnected:{_onEnter:function(){u.log("FSM: disconnected._onEnter()"),this.connection=null},connect:function(){this.transition("connecting")}},connecting:{_onEnter:function(){u.log("FSM: connecting._onEnter()"),v()},connection_ok:function(t){this.connection=t,this.transition("connected")},connection_failed:function(t){this.transition("disconnected")},disconnect:function(){this.transition("disconnecting")}},connected:{_onEnter:function(){u.log("FSM: connected._onEnter()")},connection_failed:function(){l&&"function"==typeof l.onConnectionFailed&&l.onConnectionFailed("connection failed"),this.connection=null,this.reconnectCounter=0,this.transition("reconnect_wait")},disconnect:function(){this.transition("disconnecting")}},reconnect_wait:{_onEnter:function(){u.log("FSM: reconnect_wait._onEnter()"),this.reconnectCounter<60?this.handle("schedule_reconnect"):this.handle("reconnection_failed")},schedule_reconnect:function(){u.log("FSM reconnect_wait.schedule_reconnect(): Reconnecting to broker in 3 sec..."),clearTimeout(this.reconnectTimer),this.reconnectTimer=setTimeout(function(){this.handle("connect")}.bind(this),3e3)},connect:function(){this.transition("reconnecting")},disconnect:function(){this.transition("disconnecting")},reconnection_failed:function(){this.transition("disconnected")},_onExit:function(){clearTimeout(this.reconnectTimer)}},reconnecting:{_onEnter:function(){u.log("FSM: reconnecting._onEnter()"),this.reconnectCounter++,v()},connection_ok:function(t){this.connection=t,this.transition("connected"),w()},connection_failed:function(t){l&&"function"==typeof l.onConnectionFailed&&l.onConnectionFailed(t),this.transition("reconnect_wait")},disconnect:function(){this.transition("disconnecting")}},disconnecting:{_onEnter:function(){u.log("FSM: disconnecting._onEnter()"),k(),this.connection?this.connection.stop().catch((function(){})).finally(function(){u.log("connection stopped"),this.handle("disconnect_ok")}.bind(this)):this.handle("disconnect_ok")},disconnect_ok:function(){this.transition("disconnected")}}}})}(c=o.machina),i=i||a,(n=n||{}).brokerTransport=n.brokerTransport||"WebSockets",n.brokerLogLevel=n.brokerLogLevel||"none",n.streamingSubscribeOnly=n.streamingSubscribeOnly||!1,(t&&t!==h.brokerUrl||n.brokerTransport!==h.brokerTransport||n.brokerLogLevel!==h.brokerLogLevel)&&(u=i,h.brokerUrl=t,h.brokerTransport=n.brokerTransport,h.brokerLogLevel=n.brokerLogLevel,h.streamingSubscribeOnly=n.streamingSubscribeOnly,l=r,u.log("Initializing StreamConnector"),u.log("SignalR client lib version:",e.VERSION),"disconnected"!==p.state&&y().then((function(){return b().then((function(t){return w().then((function(t){u.log("reConnectToBroker: all topics re-subscribed:",t)})),Promise.resolve(t)}))})).then((function(t){u.log("StreamConnector: broker config changed: Successfully re-connected to broker",t)}),(function(t){u.error("StreamConnector: broker config changed: Error re-connecting to broker",t)})))},getSubscriptions:function(){return f},addSubscription:function(t,e){return u.log("addSubscription:",t,e),C(t.topic),f[t.topic]=t,e?o.promiseTimeout(E(t.topic),e):E(t.topic)},removeTopicSubscription:function(t){u.log("removeTopicSubscription:",t),f[t]&&(C(t),delete f[t]),o.isEmpty(f)&&(u.log("No more subscriptions - disconnecting from broker"),y())},publishTopicIfConnected:function(t,e){return g()?function(t,e){return m().then((function(n){try{return n.invoke("Publish",t,e)}catch(t){return u.log("Exception in publishTopic: ",t),Promise.reject(t)}}))}(t,e):Promise.reject("Not connetced")}}}.apply(e,[n]))||(t.exports=r)},117:function(t,e,n){var r;void 0===(r=function(){"use strict";return{BROKER_DISCONNECTED:0,BROKER_CONNECT_ERROR:1,BROKER_RECONNECT_ATTEMPT_ERROR:2,BROKER_RECONNECT_FATAL_ERROR:3,BROKER_INVALID_CONNECTION_ERROR:4,TOPIC_GET_ERROR:5,TOPIC_SUBSCRIBE_ERROR:6,TOPIC_STREAM_OUT_OF_ORDER:7}}.call(e,n,e,t))||(t.exports=r)},215:function(t,e,n){var r;void 0===(r=function(){"use strict";return{STATE:"state",STREAM:"stream",STREAMED_CHUNK:"chunk"}}.call(e,n,e,t))||(t.exports=r)},690:function(t,e,n){var r;r=function(t){"use strict";function e(t){return new Promise((function(e){return setTimeout(e,t)}))}return{retryPromiseFunc:function t(n,r,o,i){return new Promise((function(c,s){return n().then(c).catch((function(a){return o-1>0&&a!==i?e(r).then(t.bind(null,n,r,o-1,i)).then(c).catch(s):s(a)}))}))},promiseTimeout:function(t,n){return Promise.race([t,new Promise((function(t,r){e(n).then(r.bind(null,"timeout"))}))])},isEmpty:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},extend:function t(){var e={},n=!1,r=0;"boolean"==typeof arguments[0]&&(n=arguments[0],r++);for(var o=function(r){for(var o in r)r.hasOwnProperty(o)&&(n&&"[object Object]"===Object.prototype.toString.call(r[o])?e[o]=t(!0,e[o],r[o]):e[o]=r[o])};r<arguments.length;r++)o(arguments[r]);return e}}}.call(e,n,e,t),void 0===r||(t.exports=r)},956:function(t,e,n){var r;void 0===(r=function(t){"use strict";var e=n(690),r={topic:"",fromEventId:null,subscribeInvocationId:-1,subscriberRef:null,lastReceivedEventId:-1,onDataReceived:function(){},onSubscriptionStart:null,onSubscriptionEnd:null};return{extend:function(t){return e.extend({},r,t)}}}.call(e,n,e,t))||(t.exports=r)},91:function(t,e,n){var r;void 0===(r=function(t){"use strict";return{StreamEventTypes:n(215),StreamErrors:n(117),StreamConnector:n(643),Subscription:n(956)}}.call(e,n,e,t))||(t.exports=r)},279:function(t,e,n){var r,o,i,c;function s(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||h(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],c=!0,s=!1;try{for(n=n.call(t);!(c=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{c||null==n.return||n.return()}finally{if(s)throw o}}return i}(t,e)||h(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=h(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){s=!0,i=t},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw i}}}}function h(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function f(t,e,n,r,o,i,c){try{var s=t[i](c),a=s.value}catch(t){return void n(t)}s.done?e(a):Promise.resolve(a).then(r,o)}function d(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function c(t){f(i,r,o,c,s,"next",t)}function s(t){f(i,r,o,c,s,"throw",t)}c(void 0)}))}}function p(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(Object(n),!0).forEach((function(e){g(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function y(t,e,n){return e&&b(t.prototype,e),n&&b(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&x(t,e)}function k(t){var e=T();return function(){var n,r=R(t);if(e){var o=R(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return E(this,n)}}function E(t,e){if(e&&("object"===I(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function S(t){var e="function"==typeof Map?new Map:void 0;return S=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return C(t,arguments,R(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),x(r,t)},S(t)}function C(t,e,n){return C=T()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&x(o,n.prototype),o},C.apply(null,arguments)}function T(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function x(t,e){return x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},x(t,e)}function R(t){return R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},R(t)}function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}t=n.nmd(t),self,c=function(){return function(){var t={d:function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})}};t.g=function(){if("object"==("undefined"==typeof globalThis?"undefined":I(globalThis)))return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==("undefined"==typeof window?"undefined":I(window)))return window}}(),t.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},t.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"t",{value:!0})};var e,r={};t.r(r),t.d(r,{AbortError:function(){return c},DefaultHttpClient:function(){return G},HttpClient:function(){return T},HttpError:function(){return o},HttpResponse:function(){return C},HttpTransportType:function(){return Z},HubConnection:function(){return Q},HubConnectionBuilder:function(){return ft},HubConnectionState:function(){return z},JsonHubProtocol:function(){return ht},LogLevel:function(){return e},MessageType:function(){return J},NullLogger:function(){return x},Subject:function(){return V},TimeoutError:function(){return i},TransferFormat:function(){return Y},VERSION:function(){return R}});var o=function(t){w(n,t);var e=k(n);function n(t,r){var o;m(this,n);var i=(this instanceof n?this.constructor:void 0).prototype;return(o=e.call(this,"".concat(t,": Status code '").concat(r,"'"))).statusCode=r,o.__proto__=i,o}return y(n)}(S(Error)),i=function(t){w(n,t);var e=k(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"A timeout occurred.";m(this,n);var o=(this instanceof n?this.constructor:void 0).prototype;return(t=e.call(this,r)).__proto__=o,t}return y(n)}(S(Error)),c=function(t){w(n,t);var e=k(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"An abort occurred.";m(this,n);var o=(this instanceof n?this.constructor:void 0).prototype;return(t=e.call(this,r)).__proto__=o,t}return y(n)}(S(Error)),h=function(t){w(n,t);var e=k(n);function n(t,r){var o;m(this,n);var i=(this instanceof n?this.constructor:void 0).prototype;return(o=e.call(this,t)).transport=r,o.errorType="UnsupportedTransportError",o.__proto__=i,o}return y(n)}(S(Error)),l=function(t){w(n,t);var e=k(n);function n(t,r){var o;m(this,n);var i=(this instanceof n?this.constructor:void 0).prototype;return(o=e.call(this,t)).transport=r,o.errorType="DisabledTransportError",o.__proto__=i,o}return y(n)}(S(Error)),f=function(t){w(n,t);var e=k(n);function n(t,r){var o;m(this,n);var i=(this instanceof n?this.constructor:void 0).prototype;return(o=e.call(this,t)).transport=r,o.errorType="FailedToStartTransportError",o.__proto__=i,o}return y(n)}(S(Error)),p=function(t){w(n,t);var e=k(n);function n(t){var r;m(this,n);var o=(this instanceof n?this.constructor:void 0).prototype;return(r=e.call(this,t)).errorType="FailedToNegotiateWithServerError",r.__proto__=o,r}return y(n)}(S(Error)),b=function(t){w(n,t);var e=k(n);function n(t,r){var o;m(this,n);var i=(this instanceof n?this.constructor:void 0).prototype;return(o=e.call(this,t)).innerErrors=r,o.__proto__=i,o}return y(n)}(S(Error)),C=y((function t(e,n,r){m(this,t),this.statusCode=e,this.statusText=n,this.content=r})),T=function(){function t(){m(this,t)}return y(t,[{key:"get",value:function(t,e){return this.send(v(v({},e),{},{method:"GET",url:t}))}},{key:"post",value:function(t,e){return this.send(v(v({},e),{},{method:"POST",url:t}))}},{key:"delete",value:function(t,e){return this.send(v(v({},e),{},{method:"DELETE",url:t}))}},{key:"getCookieString",value:function(t){return""}}]),t}();!function(t){t[t.Trace=0]="Trace",t[t.Debug=1]="Debug",t[t.Information=2]="Information",t[t.Warning=3]="Warning",t[t.Error=4]="Error",t[t.Critical=5]="Critical",t[t.None=6]="None"}(e||(e={}));var x=function(){function t(){m(this,t)}return y(t,[{key:"log",value:function(t,e){}}]),t}();x.instance=new x;var R="6.0.1",P=function(){function t(){m(this,t)}return y(t,null,[{key:"isRequired",value:function(t,e){if(null==t)throw new Error("The '".concat(e,"' argument is required."))}},{key:"isNotEmpty",value:function(t,e){if(!t||t.match(/^\s*$/))throw new Error("The '".concat(e,"' argument should not be empty."))}},{key:"isIn",value:function(t,e,n){if(!(t in e))throw new Error("Unknown ".concat(n," value: ").concat(t,"."))}}]),t}(),O=function(){function t(){m(this,t)}return y(t,null,[{key:"isBrowser",get:function(){return"object"==("undefined"==typeof window?"undefined":I(window))}},{key:"isWebWorker",get:function(){return"object"==("undefined"==typeof self?"undefined":I(self))&&"importScripts"in self}},{key:"isNode",get:function(){return!this.isBrowser&&!this.isWebWorker}}]),t}();function _(t,e){var n="";return D(t)?(n="Binary data of length ".concat(t.byteLength),e&&(n+=". Content: '".concat(function(t){var e=new Uint8Array(t),n="";return e.forEach((function(t){n+="0x".concat(t<16?"0":"").concat(t.toString(16)," ")})),n.substr(0,n.length-1)}(t),"'"))):"string"==typeof t&&(n="String data of length ".concat(t.length),e&&(n+=". Content: '".concat(t,"'"))),n}function D(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function A(t,e,n,r,o,i,c){return j.apply(this,arguments)}function j(){return j=d(regeneratorRuntime.mark((function t(n,r,o,i,c,s,u){var h,l,f,d,p,g,b,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(h={},!c){t.next=6;break}return t.next=4,c();case 4:(l=t.sent)&&(h={Authorization:"Bearer ".concat(l)});case 6:return f=L(),d=a(f,2),p=d[0],g=d[1],h[p]=g,n.log(e.Trace,"(".concat(r," transport) sending data. ").concat(_(s,u.logMessageContent),".")),b=D(s)?"arraybuffer":"text",t.next=11,o.post(i,{content:s,headers:v(v({},h),u.headers),responseType:b,timeout:u.timeout,withCredentials:u.withCredentials});case 11:y=t.sent,n.log(e.Trace,"(".concat(r," transport) request complete. Response status: ").concat(y.statusCode,"."));case 13:case"end":return t.stop()}}),t)}))),j.apply(this,arguments)}var N=function(){function t(e,n){m(this,t),this.i=e,this.h=n}return y(t,[{key:"dispose",value:function(){var t=this.i.observers.indexOf(this.h);t>-1&&this.i.observers.splice(t,1),0===this.i.observers.length&&this.i.cancelCallback&&this.i.cancelCallback().catch((function(t){}))}}]),t}(),q=function(){function t(e){m(this,t),this.l=e,this.out=console}return y(t,[{key:"log",value:function(t,n){if(t>=this.l){var r="[".concat((new Date).toISOString(),"] ").concat(e[t],": ").concat(n);switch(t){case e.Critical:case e.Error:this.out.error(r);break;case e.Warning:this.out.warn(r);break;case e.Information:this.out.info(r);break;default:this.out.log(r)}}}}]),t}();function L(){var t="X-SignalR-User-Agent";return O.isNode&&(t="User-Agent"),[t,H(R,U(),O.isNode?"NodeJS":"Browser",M())]}function H(t,e,n,r){var o="Microsoft SignalR/",i=t.split(".");return o+="".concat(i[0],".").concat(i[1]),o+=" (".concat(t,"; "),o+=e&&""!==e?"".concat(e,"; "):"Unknown OS; ",o+="".concat(n),o+=r?"; ".concat(r):"; Unknown Runtime Version",o+=")"}function U(){if(!O.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function M(){if(O.isNode)return process.versions.node}function W(t){return t.stack?t.stack:t.message?t.message:"".concat(t)}var B=function(r){w(u,r);var s,a=k(u);function u(e){var r;if(m(this,u),(r=a.call(this)).u=e,"undefined"==typeof fetch){r.p=new(Object(function(){var t=new Error("Cannot find module 'tough-cookie'");throw t.code="MODULE_NOT_FOUND",t}()).CookieJar),r.m=n(Object(function(){var t=new Error("Cannot find module 'node-fetch'");throw t.code="MODULE_NOT_FOUND",t}())),r.m=n(Object(function(){var t=new Error("Cannot find module 'fetch-cookie'");throw t.code="MODULE_NOT_FOUND",t}()))(r.m,r.p)}else r.m=fetch.bind(function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("could not find global")}());if("undefined"==typeof AbortController){r.v=n(Object(function(){var t=new Error("Cannot find module 'abort-controller'");throw t.code="MODULE_NOT_FOUND",t}()))}else r.v=AbortController;return E(r)}return y(u,[{key:"send",value:(s=d(regeneratorRuntime.mark((function t(n){var r,s,a,u,h,l,f,d,p=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.abortSignal||!n.abortSignal.aborted){t.next=2;break}throw new c;case 2:if(n.method){t.next=4;break}throw new Error("No method defined.");case 4:if(n.url){t.next=6;break}throw new Error("No url defined.");case 6:return r=new this.v,n.abortSignal&&(n.abortSignal.onabort=function(){r.abort(),s=new c}),u=null,n.timeout&&(h=n.timeout,u=setTimeout((function(){r.abort(),p.u.log(e.Warning,"Timeout from HTTP request."),s=new i}),h)),t.prev=10,t.next=13,this.m(n.url,{body:n.content,cache:"no-cache",credentials:!0===n.withCredentials?"include":"same-origin",headers:v({"Content-Type":"text/plain;charset=UTF-8","X-Requested-With":"XMLHttpRequest"},n.headers),method:n.method,mode:"cors",redirect:"follow",signal:r.signal});case 13:a=t.sent,t.next=21;break;case 16:if(t.prev=16,t.t0=t.catch(10),!s){t.next=20;break}throw s;case 20:throw this.u.log(e.Warning,"Error from HTTP request. ".concat(t.t0,".")),t.t0;case 21:return t.prev=21,u&&clearTimeout(u),n.abortSignal&&(n.abortSignal.onabort=null),t.finish(21);case 24:if(a.ok){t.next=29;break}return t.next=27,F(a,"text");case 27:throw l=t.sent,new o(l||a.statusText,a.status);case 29:return f=F(a,n.responseType),t.next=32,f;case 32:return d=t.sent,t.abrupt("return",new C(a.status,a.statusText,d));case 34:case"end":return t.stop()}}),t,this,[[10,16,21,24]])}))),function(t){return s.apply(this,arguments)})},{key:"getCookieString",value:function(t){var e="";return O.isNode&&this.p&&this.p.getCookies(t,(function(t,n){return e=n.join("; ")})),e}}]),u}(T);function F(t,e){var n;switch(e){case"arraybuffer":n=t.arrayBuffer();break;case"text":default:n=t.text();break;case"blob":case"document":case"json":throw new Error("".concat(e," is not supported."))}return n}var $=function(t){w(r,t);var n=k(r);function r(t){var e;return m(this,r),(e=n.call(this)).u=t,e}return y(r,[{key:"send",value:function(t){var n=this;return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new c):t.method?t.url?new Promise((function(r,s){var a=new XMLHttpRequest;a.open(t.method,t.url,!0),a.withCredentials=void 0===t.withCredentials||t.withCredentials,a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-Type","text/plain;charset=UTF-8");var u=t.headers;u&&Object.keys(u).forEach((function(t){a.setRequestHeader(t,u[t])})),t.responseType&&(a.responseType=t.responseType),t.abortSignal&&(t.abortSignal.onabort=function(){a.abort(),s(new c)}),t.timeout&&(a.timeout=t.timeout),a.onload=function(){t.abortSignal&&(t.abortSignal.onabort=null),a.status>=200&&a.status<300?r(new C(a.status,a.statusText,a.response||a.responseText)):s(new o(a.response||a.responseText||a.statusText,a.status))},a.onerror=function(){n.u.log(e.Warning,"Error from HTTP request. ".concat(a.status,": ").concat(a.statusText,".")),s(new o(a.statusText,a.status))},a.ontimeout=function(){n.u.log(e.Warning,"Timeout from HTTP request."),s(new i)},a.send(t.content||"")})):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}]),r}(T),G=function(t){w(n,t);var e=k(n);function n(t){var r;if(m(this,n),r=e.call(this),"undefined"!=typeof fetch||O.isNode)r.$=new B(t);else{if("undefined"==typeof XMLHttpRequest)throw new Error("No usable HttpClient found.");r.$=new $(t)}return E(r)}return y(n,[{key:"send",value:function(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new c):t.method?t.url?this.$.send(t):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}},{key:"getCookieString",value:function(t){return this.$.getCookieString(t)}}]),n}(T),K=function(){function t(){m(this,t)}return y(t,null,[{key:"write",value:function(e){return"".concat(e).concat(t.RecordSeparator)}},{key:"parse",value:function(e){if(e[e.length-1]!==t.RecordSeparator)throw new Error("Message is incomplete.");var n=e.split(t.RecordSeparator);return n.pop(),n}}]),t}();K.RecordSeparatorCode=30,K.RecordSeparator=String.fromCharCode(K.RecordSeparatorCode);var J,z,X=function(){function t(){m(this,t)}return y(t,[{key:"writeHandshakeRequest",value:function(t){return K.write(JSON.stringify(t))}},{key:"parseHandshakeResponse",value:function(t){var e,n;if(D(t)){var r=new Uint8Array(t),o=r.indexOf(K.RecordSeparatorCode);if(-1===o)throw new Error("Message is incomplete.");var i=o+1;e=String.fromCharCode.apply(null,Array.prototype.slice.call(r.slice(0,i))),n=r.byteLength>i?r.slice(i).buffer:null}else{var c=t,s=c.indexOf(K.RecordSeparator);if(-1===s)throw new Error("Message is incomplete.");var a=s+1;e=c.substring(0,a),n=c.length>a?c.substring(a):null}var u=K.parse(e),h=JSON.parse(u[0]);if(h.type)throw new Error("Expected a handshake response from the server.");return[n,h]}}]),t}();!function(t){t[t.Invocation=1]="Invocation",t[t.StreamItem=2]="StreamItem",t[t.Completion=3]="Completion",t[t.StreamInvocation=4]="StreamInvocation",t[t.CancelInvocation=5]="CancelInvocation",t[t.Ping=6]="Ping",t[t.Close=7]="Close"}(J||(J={}));var V=function(){function t(){m(this,t),this.observers=[]}return y(t,[{key:"next",value:function(t){var e,n=u(this.observers);try{for(n.s();!(e=n.n()).done;){e.value.next(t)}}catch(t){n.e(t)}finally{n.f()}}},{key:"error",value:function(t){var e,n=u(this.observers);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.error&&r.error(t)}}catch(t){n.e(t)}finally{n.f()}}},{key:"complete",value:function(){var t,e=u(this.observers);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.complete&&n.complete()}}catch(t){e.e(t)}finally{e.f()}}},{key:"subscribe",value:function(t){return this.observers.push(t),new N(this,t)}}]),t}();!function(t){t.Disconnected="Disconnected",t.Connecting="Connecting",t.Connected="Connected",t.Disconnecting="Disconnecting",t.Reconnecting="Reconnecting"}(z||(z={}));var Z,Y,Q=function(){function t(n,r,o,i){var c=this;m(this,t),this.C=0,this.S=function(){c.u.log(e.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://docs.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},P.isRequired(n,"connection"),P.isRequired(r,"logger"),P.isRequired(o,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this.u=r,this.k=o,this.connection=n,this.P=i,this.T=new X,this.connection.onreceive=function(t){return c.I(t)},this.connection.onclose=function(t){return c._(t)},this.H={},this.D={},this.A=[],this.R=[],this.U=[],this.L=0,this.N=!1,this.q=z.Disconnected,this.M=!1,this.W=this.k.writeMessage({type:J.Ping})}var n,r,o,i;return y(t,[{key:"state",get:function(){return this.q}},{key:"connectionId",get:function(){return this.connection&&this.connection.connectionId||null}},{key:"baseUrl",get:function(){return this.connection.baseUrl||""},set:function(t){if(this.q!==z.Disconnected&&this.q!==z.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!t)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=t}},{key:"start",value:function(){return this.O=this.j(),this.O}},{key:"j",value:(i=d(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.q===z.Disconnected){t.next=2;break}return t.abrupt("return",Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state.")));case 2:return this.q=z.Connecting,this.u.log(e.Debug,"Starting HubConnection."),t.prev=3,t.next=6,this.F();case 6:O.isBrowser&&document&&document.addEventListener("freeze",this.S),this.q=z.Connected,this.M=!0,this.u.log(e.Debug,"HubConnection connected successfully."),t.next=15;break;case 12:return t.prev=12,t.t0=t.catch(3),t.abrupt("return",(this.q=z.Disconnected,this.u.log(e.Debug,"HubConnection failed to start successfully because of error '".concat(t.t0,"'.")),Promise.reject(t.t0)));case 15:case"end":return t.stop()}}),t,this,[[3,12]])}))),function(){return i.apply(this,arguments)})},{key:"F",value:(o=d(regeneratorRuntime.mark((function t(){var n,r,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.B=void 0,this.N=!1,n=new Promise((function(t,e){o.X=t,o.J=e})),t.next=4,this.connection.start(this.k.transferFormat);case 4:return t.prev=4,r={protocol:this.k.name,version:this.k.version},this.u.log(e.Debug,"Sending handshake request."),t.next=9,this.V(this.T.writeHandshakeRequest(r));case 9:return this.u.log(e.Information,"Using HubProtocol '".concat(this.k.name,"'.")),this.G(),this.K(),this.Y(),t.next=15,n;case 15:if(!this.B){t.next=17;break}throw this.B;case 17:t.next=27;break;case 19:return t.prev=19,t.t0=t.catch(4),this.u.log(e.Debug,"Hub handshake failed with error '".concat(t.t0,"' during start(). Stopping HubConnection.")),this.G(),this.Z(),t.next=26,this.connection.stop(t.t0);case 26:throw t.t0;case 27:case"end":return t.stop()}}),t,this,[[4,19]])}))),function(){return o.apply(this,arguments)})},{key:"stop",value:(r=d(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.O,this.tt=this.et(),t.next=4,this.tt;case 4:return t.prev=4,t.next=7,e;case 7:t.next=11;break;case 9:t.prev=9,t.t0=t.catch(4);case 11:case"end":return t.stop()}}),t,this,[[4,9]])}))),function(){return r.apply(this,arguments)})},{key:"et",value:function(t){return this.q===z.Disconnected?(this.u.log(e.Debug,"Call to HubConnection.stop(".concat(t,") ignored because it is already in the disconnected state.")),Promise.resolve()):this.q===z.Disconnecting?(this.u.log(e.Debug,"Call to HttpConnection.stop(".concat(t,") ignored because the connection is already in the disconnecting state.")),this.tt):(this.q=z.Disconnecting,this.u.log(e.Debug,"Stopping HubConnection."),this.st?(this.u.log(e.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.st),this.st=void 0,this.nt(),Promise.resolve()):(this.G(),this.Z(),this.B=t||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(t)))}},{key:"stream",value:function(t){for(var e=this,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i,c=this.it(r),s=a(c,2),u=s[0],h=s[1],l=this.rt(t,r,h),f=new V;return f.cancelCallback=function(){var t=e.ot(l.invocationId);return delete e.H[l.invocationId],i.then((function(){return e.ht(t)}))},this.H[l.invocationId]=function(t,e){e?f.error(e):t&&(t.type===J.Completion?t.error?f.error(new Error(t.error)):f.complete():f.next(t.item))},i=this.ht(l).catch((function(t){f.error(t),delete e.H[l.invocationId]})),this.ct(u,i),f}},{key:"V",value:function(t){return this.Y(),this.connection.send(t)}},{key:"ht",value:function(t){return this.V(this.k.writeMessage(t))}},{key:"send",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=this.it(n),i=a(o,2),c=i[0],s=i[1],u=this.ht(this.at(t,n,!0,s));return this.ct(c,u),u}},{key:"invoke",value:function(t){for(var e=this,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=this.it(r),c=a(i,2),s=c[0],u=c[1],h=this.at(t,r,!1,u);return new Promise((function(t,n){e.H[h.invocationId]=function(e,r){r?n(r):e&&(e.type===J.Completion?e.error?n(new Error(e.error)):t(e.result):n(new Error("Unexpected message type: ".concat(e.type))))};var r=e.ht(h).catch((function(t){n(t),delete e.H[h.invocationId]}));e.ct(s,r)}))}},{key:"on",value:function(t,e){t&&e&&(t=t.toLowerCase(),this.D[t]||(this.D[t]=[]),-1===this.D[t].indexOf(e)&&this.D[t].push(e))}},{key:"off",value:function(t,e){if(t){t=t.toLowerCase();var n=this.D[t];if(n)if(e){var r=n.indexOf(e);-1!==r&&(n.splice(r,1),0===n.length&&delete this.D[t])}else delete this.D[t]}}},{key:"onclose",value:function(t){t&&this.A.push(t)}},{key:"onreconnecting",value:function(t){t&&this.R.push(t)}},{key:"onreconnected",value:function(t){t&&this.U.push(t)}},{key:"I",value:function(t){if(this.G(),this.N||(t=this.lt(t),this.N=!0),t){var n,r=u(this.k.parseMessages(t,this.u));try{for(r.s();!(n=r.n()).done;){var o=n.value;switch(o.type){case J.Invocation:this.ut(o);break;case J.StreamItem:case J.Completion:var i=this.H[o.invocationId];if(i){o.type===J.Completion&&delete this.H[o.invocationId];try{i(o)}catch(t){this.u.log(e.Error,"Stream callback threw error: ".concat(W(t)))}}break;case J.Ping:break;case J.Close:this.u.log(e.Information,"Close message received from server.");var c=o.error?new Error("Server returned an error on close: "+o.error):void 0;!0===o.allowReconnect?this.connection.stop(c):this.tt=this.et(c);break;default:this.u.log(e.Warning,"Invalid message type: ".concat(o.type,"."))}}}catch(t){r.e(t)}finally{r.f()}}this.K()}},{key:"lt",value:function(t){var n,r;try{var o=a(this.T.parseHandshakeResponse(t),2);r=o[0],n=o[1]}catch(t){var i="Error parsing handshake response: "+t;this.u.log(e.Error,i);var c=new Error(i);throw this.J(c),c}if(n.error){var s="Server returned handshake error: "+n.error;this.u.log(e.Error,s);var u=new Error(s);throw this.J(u),u}return this.u.log(e.Debug,"Server handshake complete."),this.X(),r}},{key:"Y",value:function(){this.connection.features.inherentKeepAlive||(this.C=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this.Z())}},{key:"K",value:function(){var t=this;if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this.dt=setTimeout((function(){return t.serverTimeout()}),this.serverTimeoutInMilliseconds),void 0!==this.ft))){var e=this.C-(new Date).getTime();e<0&&(e=0),this.ft=setTimeout(d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.q!==z.Connected){e.next=9;break}return e.prev=1,e.next=4,t.V(t.W);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),t.Z();case 9:case"end":return e.stop()}}),e,null,[[1,6]])}))),e)}}},{key:"serverTimeout",value:function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}},{key:"ut",value:function(t){var n=this,r=this.D[t.target.toLowerCase()];if(r){try{r.forEach((function(e){return e.apply(n,t.arguments)}))}catch(r){this.u.log(e.Error,"A callback for the method ".concat(t.target.toLowerCase()," threw error '").concat(r,"'."))}if(t.invocationId){var o="Server requested a response, which is not supported in this version of the client.";this.u.log(e.Error,o),this.tt=this.et(new Error(o))}}else this.u.log(e.Warning,"No client method with the name '".concat(t.target,"' found."))}},{key:"_",value:function(t){this.u.log(e.Debug,"HubConnection.connectionClosed(".concat(t,") called while in state ").concat(this.q,".")),this.B=this.B||t||new Error("The underlying connection was closed before the hub handshake could complete."),this.X&&this.X(),this.wt(t||new Error("Invocation canceled due to the underlying connection being closed.")),this.G(),this.Z(),this.q===z.Disconnecting?this.nt(t):this.q===z.Connected&&this.P?this.gt(t):this.q===z.Connected&&this.nt(t)}},{key:"nt",value:function(t){var n=this;if(this.M){this.q=z.Disconnected,this.M=!1,O.isBrowser&&document&&document.removeEventListener("freeze",this.S);try{this.A.forEach((function(e){return e.apply(n,[t])}))}catch(n){this.u.log(e.Error,"An onclose callback called with error '".concat(t,"' threw error '").concat(n,"'."))}}}},{key:"gt",value:(n=d(regeneratorRuntime.mark((function t(n){var r,o,i,c,s=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Date.now(),o=0,i=void 0!==n?n:new Error("Attempting to reconnect due to a unknown error."),null!==(c=this.yt(o++,0,i))){t.next=4;break}return t.abrupt("return",(this.u.log(e.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this.nt(n)));case 4:if(this.q=z.Reconnecting,n?this.u.log(e.Information,"Connection reconnecting because of error '".concat(n,"'.")):this.u.log(e.Information,"Connection reconnecting."),0===this.R.length){t.next=8;break}try{this.R.forEach((function(t){return t.apply(s,[n])}))}catch(t){this.u.log(e.Error,"An onreconnecting callback called with error '".concat(n,"' threw error '").concat(t,"'."))}if(this.q===z.Reconnecting){t.next=8;break}return t.abrupt("return",void this.u.log(e.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting."));case 8:if(null===c){t.next=32;break}return this.u.log(e.Information,"Reconnect attempt number ".concat(o," will start in ").concat(c," ms.")),t.next=12,new Promise((function(t){s.st=setTimeout(t,c)}));case 12:if(this.st=void 0,this.q===z.Reconnecting){t.next=15;break}return t.abrupt("return",void this.u.log(e.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting."));case 15:return t.prev=15,t.next=18,this.F();case 18:if(this.q=z.Connected,this.u.log(e.Information,"HubConnection reconnected successfully."),0===this.U.length){t.next=22;break}try{this.U.forEach((function(t){return t.apply(s,[s.connection.connectionId])}))}catch(t){this.u.log(e.Error,"An onreconnected callback called with connectionId '".concat(this.connection.connectionId,"; threw error '").concat(t,"'."))}case 22:return t.abrupt("return");case 25:if(t.prev=25,t.t0=t.catch(15),this.u.log(e.Information,"Reconnect attempt failed because of error '".concat(t.t0,"'.")),this.q===z.Reconnecting){t.next=29;break}return t.abrupt("return",(this.u.log(e.Debug,"Connection moved to the '".concat(this.q,"' from the reconnecting state during reconnect attempt. Done reconnecting.")),void(this.q===z.Disconnecting&&this.nt())));case 29:i=t.t0 instanceof Error?t.t0:new Error(t.t0.toString()),c=this.yt(o++,Date.now()-r,i);case 30:t.next=8;break;case 32:this.u.log(e.Information,"Reconnect retries have been exhausted after ".concat(Date.now()-r," ms and ").concat(o," failed attempts. Connection disconnecting.")),this.nt();case 33:case"end":return t.stop()}}),t,this,[[15,25]])}))),function(t){return n.apply(this,arguments)})},{key:"yt",value:function(t,n,r){try{return this.P.nextRetryDelayInMilliseconds({elapsedMilliseconds:n,previousRetryCount:t,retryReason:r})}catch(r){return this.u.log(e.Error,"IRetryPolicy.nextRetryDelayInMilliseconds(".concat(t,", ").concat(n,") threw error '").concat(r,"'.")),null}}},{key:"wt",value:function(t){var n=this,r=this.H;this.H={},Object.keys(r).forEach((function(o){var i=r[o];try{i(null,t)}catch(r){n.u.log(e.Error,"Stream 'error' callback called with '".concat(t,"' threw error: ").concat(W(r)))}}))}},{key:"Z",value:function(){this.ft&&(clearTimeout(this.ft),this.ft=void 0)}},{key:"G",value:function(){this.dt&&clearTimeout(this.dt)}},{key:"at",value:function(t,e,n,r){if(n)return 0!==r.length?{arguments:e,streamIds:r,target:t,type:J.Invocation}:{arguments:e,target:t,type:J.Invocation};var o=this.L;return this.L++,0!==r.length?{arguments:e,invocationId:o.toString(),streamIds:r,target:t,type:J.Invocation}:{arguments:e,invocationId:o.toString(),target:t,type:J.Invocation}}},{key:"ct",value:function(t,e){var n=this;if(0!==t.length){e||(e=Promise.resolve());var r=function(r){t[r].subscribe({complete:function(){e=e.then((function(){return n.ht(n.bt(r))}))},error:function(t){var o;o=t instanceof Error?t.message:t&&t.toString?t.toString():"Unknown error",e=e.then((function(){return n.ht(n.bt(r,o))}))},next:function(t){e=e.then((function(){return n.ht(n.vt(r,t))}))}})};for(var o in t)r(o)}}},{key:"it",value:function(t){for(var e=[],n=[],r=0;r<t.length;r++){var o=t[r];if(this.Et(o)){var i=this.L;this.L++,e[i]=o,n.push(i.toString()),t.splice(r,1)}}return[e,n]}},{key:"Et",value:function(t){return t&&t.subscribe&&"function"==typeof t.subscribe}},{key:"rt",value:function(t,e,n){var r=this.L;return this.L++,0!==n.length?{arguments:e,invocationId:r.toString(),streamIds:n,target:t,type:J.StreamInvocation}:{arguments:e,invocationId:r.toString(),target:t,type:J.StreamInvocation}}},{key:"ot",value:function(t){return{invocationId:t,type:J.CancelInvocation}}},{key:"vt",value:function(t,e){return{invocationId:t,item:e,type:J.StreamItem}}},{key:"bt",value:function(t,e,n){return e?{error:e,invocationId:t,type:J.Completion}:{invocationId:t,result:n,type:J.Completion}}}],[{key:"create",value:function(e,n,r,o){return new t(e,n,r,o)}}]),t}(),tt=[0,2e3,1e4,3e4,null],et=function(){function t(e){m(this,t),this.$t=void 0!==e?[].concat(s(e),[null]):tt}return y(t,[{key:"nextRetryDelayInMilliseconds",value:function(t){return this.$t[t.previousRetryCount]}}]),t}(),nt=y((function t(){m(this,t)}));nt.Authorization="Authorization",nt.Cookie="Cookie",function(t){t[t.None=0]="None",t[t.WebSockets=1]="WebSockets",t[t.ServerSentEvents=2]="ServerSentEvents",t[t.LongPolling=4]="LongPolling"}(Z||(Z={})),function(t){t[t.Text=1]="Text",t[t.Binary=2]="Binary"}(Y||(Y={}));var rt=function(){function t(){m(this,t),this.Ct=!1,this.onabort=null}return y(t,[{key:"abort",value:function(){this.Ct||(this.Ct=!0,this.onabort&&this.onabort())}},{key:"signal",get:function(){return this}},{key:"aborted",get:function(){return this.Ct}}]),t}(),ot=function(){function t(e,n,r,o){m(this,t),this.$=e,this.St=n,this.u=r,this.kt=new rt,this.Pt=o,this.Tt=!1,this.onreceive=null,this.onclose=null}var n,r,c,s,u;return y(t,[{key:"pollAborted",get:function(){return this.kt.aborted}},{key:"connect",value:(u=d(regeneratorRuntime.mark((function t(n,r){var i,c,s,u,h,l,f,d,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(P.isRequired(n,"url"),P.isRequired(r,"transferFormat"),P.isIn(r,Y,"transferFormat"),this.It=n,this.u.log(e.Trace,"(LongPolling transport) Connecting."),r!==Y.Binary||"undefined"==typeof XMLHttpRequest||"string"==typeof(new XMLHttpRequest).responseType){t.next=2;break}throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");case 2:return i=L(),c=a(i,2),s=c[0],u=c[1],h=v(g({},s,u),this.Pt.headers),l={abortSignal:this.kt.signal,headers:h,timeout:1e5,withCredentials:this.Pt.withCredentials},r===Y.Binary&&(l.responseType="arraybuffer"),t.next=6,this._t();case 6:return f=t.sent,this.Ht(l,f),d="".concat(n,"&_=").concat(Date.now()),this.u.log(e.Trace,"(LongPolling transport) polling: ".concat(d,".")),t.next=12,this.$.get(d,l);case 12:200!==(p=t.sent).statusCode?(this.u.log(e.Error,"(LongPolling transport) Unexpected response code: ".concat(p.statusCode,".")),this.Dt=new o(p.statusText||"",p.statusCode),this.Tt=!1):this.Tt=!0,this.xt=this.At(this.It,l);case 14:case"end":return t.stop()}}),t,this)}))),function(t,e){return u.apply(this,arguments)})},{key:"_t",value:(s=d(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.St){t.next=6;break}return t.next=3,this.St();case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0=null;case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"Ht",value:function(t,e){t.headers||(t.headers={}),e?t.headers[nt.Authorization]="Bearer ".concat(e):t.headers[nt.Authorization]&&delete t.headers[nt.Authorization]}},{key:"At",value:(c=d(regeneratorRuntime.mark((function t(n,r){var c,s,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0;case 1:if(!this.Tt){t.next=20;break}return t.next=4,this._t();case 4:return c=t.sent,this.Ht(r,c),t.prev=6,s="".concat(n,"&_=").concat(Date.now()),this.u.log(e.Trace,"(LongPolling transport) polling: ".concat(s,".")),t.next=11,this.$.get(s,r);case 11:204===(a=t.sent).statusCode?(this.u.log(e.Information,"(LongPolling transport) Poll terminated by server."),this.Tt=!1):200!==a.statusCode?(this.u.log(e.Error,"(LongPolling transport) Unexpected response code: ".concat(a.statusCode,".")),this.Dt=new o(a.statusText||"",a.statusCode),this.Tt=!1):a.content?(this.u.log(e.Trace,"(LongPolling transport) data received. ".concat(_(a.content,this.Pt.logMessageContent),".")),this.onreceive&&this.onreceive(a.content)):this.u.log(e.Trace,"(LongPolling transport) Poll timed out, reissuing."),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(6),this.Tt?t.t0 instanceof i?this.u.log(e.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.Dt=t.t0,this.Tt=!1):this.u.log(e.Trace,"(LongPolling transport) Poll errored after shutdown: ".concat(t.t0.message));case 18:t.next=1;break;case 20:return t.prev=20,this.u.log(e.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.Rt(),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[0,,20,23],[6,15]])}))),function(t,e){return c.apply(this,arguments)})},{key:"send",value:(r=d(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.Tt?A(this.u,"LongPolling",this.$,this.It,this.St,e,this.Pt):Promise.reject(new Error("Cannot send until the transport is connected")));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"stop",value:(n=d(regeneratorRuntime.mark((function t(){var n,r,o,i,c,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.u.log(e.Trace,"(LongPolling transport) Stopping polling."),this.Tt=!1,this.kt.abort(),t.prev=1,t.next=4,this.xt;case 4:return this.u.log(e.Trace,"(LongPolling transport) sending DELETE request to ".concat(this.It,".")),n={},r=L(),o=a(r,2),i=o[0],c=o[1],n[i]=c,s={headers:v(v({},n),this.Pt.headers),timeout:this.Pt.timeout,withCredentials:this.Pt.withCredentials},t.next=10,this._t();case 10:return u=t.sent,this.Ht(s,u),t.next=14,this.$.delete(this.It,s);case 14:this.u.log(e.Trace,"(LongPolling transport) DELETE request sent.");case 15:return t.prev=15,this.u.log(e.Trace,"(LongPolling transport) Stop finished."),this.Rt(),t.finish(15);case 18:case"end":return t.stop()}}),t,this,[[1,,15,18]])}))),function(){return n.apply(this,arguments)})},{key:"Rt",value:function(){if(this.onclose){var t="(LongPolling transport) Firing onclose event.";this.Dt&&(t+=" Error: "+this.Dt),this.u.log(e.Trace,t),this.onclose(this.Dt)}}}]),t}(),it=function(){function t(e,n,r,o){m(this,t),this.$=e,this.St=n,this.u=r,this.Pt=o,this.onreceive=null,this.onclose=null}var n,r;return y(t,[{key:"connect",value:(r=d(regeneratorRuntime.mark((function t(n,r){var o,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(P.isRequired(n,"url"),P.isRequired(r,"transferFormat"),P.isIn(r,Y,"transferFormat"),this.u.log(e.Trace,"(SSE transport) Connecting."),this.It=n,!this.St){t.next=5;break}return t.next=3,this.St();case 3:(o=t.sent)&&(n+=(n.indexOf("?")<0?"?":"&")+"access_token=".concat(encodeURIComponent(o)));case 5:return t.abrupt("return",new Promise((function(t,o){var c,s=!1;if(r===Y.Text){if(O.isBrowser||O.isWebWorker)c=new i.Pt.EventSource(n,{withCredentials:i.Pt.withCredentials});else{var u=i.$.getCookieString(n),h={};h.Cookie=u;var l=a(L(),2),f=l[0],d=l[1];h[f]=d,c=new i.Pt.EventSource(n,{withCredentials:i.Pt.withCredentials,headers:v(v({},h),i.Pt.headers)})}try{c.onmessage=function(t){if(i.onreceive)try{i.u.log(e.Trace,"(SSE transport) data received. ".concat(_(t.data,i.Pt.logMessageContent),".")),i.onreceive(t.data)}catch(t){return void i.Ut(t)}},c.onerror=function(t){s?i.Ut():o(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},c.onopen=function(){i.u.log(e.Information,"SSE connected to ".concat(i.It)),i.Lt=c,s=!0,t()}}catch(t){return void o(t)}}else o(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})));case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"send",value:(n=d(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.Lt?A(this.u,"SSE",this.$,this.It,this.St,e,this.Pt):Promise.reject(new Error("Cannot send until the transport is connected")));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"stop",value:function(){return this.Ut(),Promise.resolve()}},{key:"Ut",value:function(t){this.Lt&&(this.Lt.close(),this.Lt=void 0,this.onclose&&this.onclose(t))}}]),t}(),ct=function(){function t(e,n,r,o,i,c){m(this,t),this.u=r,this.St=n,this.Nt=o,this.qt=i,this.$=e,this.onreceive=null,this.onclose=null,this.Mt=c}var n;return y(t,[{key:"connect",value:(n=d(regeneratorRuntime.mark((function t(n,r){var o,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(P.isRequired(n,"url"),P.isRequired(r,"transferFormat"),P.isIn(r,Y,"transferFormat"),this.u.log(e.Trace,"(WebSockets transport) Connecting."),!this.St){t.next=5;break}return t.next=3,this.St();case 3:(o=t.sent)&&(n+=(n.indexOf("?")<0?"?":"&")+"access_token=".concat(encodeURIComponent(o)));case 5:return t.abrupt("return",new Promise((function(t,o){var c;n=n.replace(/^http/,"ws");var s=i.$.getCookieString(n),u=!1;if(O.isNode){var h={},l=a(L(),2),f=l[0],d=l[1];h[f]=d,s&&(h[nt.Cookie]="".concat(s)),c=new i.qt(n,void 0,{headers:v(v({},h),i.Mt)})}c||(c=new i.qt(n)),r===Y.Binary&&(c.binaryType="arraybuffer"),c.onopen=function(r){i.u.log(e.Information,"WebSocket connected to ".concat(n,".")),i.Wt=c,u=!0,t()},c.onerror=function(t){var n;n="undefined"!=typeof ErrorEvent&&t instanceof ErrorEvent?t.error:"There was an error with the transport",i.u.log(e.Information,"(WebSockets transport) ".concat(n,"."))},c.onmessage=function(t){if(i.u.log(e.Trace,"(WebSockets transport) data received. ".concat(_(t.data,i.Nt),".")),i.onreceive)try{i.onreceive(t.data)}catch(t){return void i.Ut(t)}},c.onclose=function(t){var e;u?i.Ut(t):(e="undefined"!=typeof ErrorEvent&&t instanceof ErrorEvent?t.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",o(new Error(e)))}})));case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"send",value:function(t){return this.Wt&&this.Wt.readyState===this.qt.OPEN?(this.u.log(e.Trace,"(WebSockets transport) sending data. ".concat(_(t,this.Nt),".")),this.Wt.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}},{key:"stop",value:function(){return this.Wt&&this.Ut(void 0),Promise.resolve()}},{key:"Ut",value:function(t){this.Wt&&(this.Wt.onclose=function(){},this.Wt.onmessage=function(){},this.Wt.onerror=function(){},this.Wt.close(),this.Wt=void 0),this.u.log(e.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this.Ot(t)||!1!==t.wasClean&&1e3===t.code?t instanceof Error?this.onclose(t):this.onclose():this.onclose(new Error("WebSocket closed with status code: ".concat(t.code," (").concat(t.reason||"no reason given",")."))))}},{key:"Ot",value:function(t){return t&&"boolean"==typeof t.wasClean&&"number"==typeof t.code}}]),t}(),st=function(){function t(r){var o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(m(this,t),this.jt=function(){},this.features={},this.Ft=1,P.isRequired(r,"url"),this.u=void 0===(o=i.logger)?new q(e.Information):null===o?x.instance:void 0!==o.log?o:new q(o),this.baseUrl=this.Bt(r),(i=i||{}).logMessageContent=void 0!==i.logMessageContent&&i.logMessageContent,"boolean"!=typeof i.withCredentials&&void 0!==i.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");i.withCredentials=void 0===i.withCredentials||i.withCredentials,i.timeout=void 0===i.timeout?1e5:i.timeout;var c=null,s=null;if(O.isNode){c=n(26),s=n(Object(function(){var t=new Error("Cannot find module 'eventsource'");throw t.code="MODULE_NOT_FOUND",t}()))}O.isNode||"undefined"==typeof WebSocket||i.WebSocket?O.isNode&&!i.WebSocket&&c&&(i.WebSocket=c):i.WebSocket=WebSocket,O.isNode||"undefined"==typeof EventSource||i.EventSource?O.isNode&&!i.EventSource&&void 0!==s&&(i.EventSource=s):i.EventSource=EventSource,this.$=i.httpClient||new G(this.u),this.q="Disconnected",this.M=!1,this.Pt=i,this.onreceive=null,this.onclose=null}var r,i,c,s,g,w;return y(t,[{key:"start",value:(w=d(regeneratorRuntime.mark((function t(n){var r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=n||Y.Binary,P.isIn(n,Y,"transferFormat"),this.u.log(e.Debug,"Starting connection with transfer format '".concat(Y[n],"'.")),"Disconnected"===this.q){t.next=2;break}return t.abrupt("return",Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state.")));case 2:return this.q="Connecting",this.Xt=this.F(n),t.next=6,this.Xt;case 6:if("Disconnecting"!==this.q){t.next=12;break}return r="Failed to start the HttpConnection before stop() was called.",this.u.log(e.Error,r),t.next=11,this.tt;case 11:return t.abrupt("return",Promise.reject(new Error(r)));case 12:if("Connected"===this.q){t.next=15;break}return o="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!",t.abrupt("return",(this.u.log(e.Error,o),Promise.reject(new Error(o))));case 15:this.M=!0;case 16:case"end":return t.stop()}}),t,this)}))),function(t){return w.apply(this,arguments)})},{key:"send",value:function(t){return"Connected"!==this.q?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.Jt||(this.Jt=new at(this.transport)),this.Jt.send(t))}},{key:"stop",value:(g=d(regeneratorRuntime.mark((function t(n){var r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("Disconnected"!==this.q){t.next=4;break}t.t0=(this.u.log(e.Debug,"Call to HttpConnection.stop(".concat(n,") ignored because the connection is already in the disconnected state.")),Promise.resolve()),t.next=16;break;case 4:if("Disconnecting"!==this.q){t.next=8;break}t.t1=(this.u.log(e.Debug,"Call to HttpConnection.stop(".concat(n,") ignored because the connection is already in the disconnecting state.")),this.tt),t.next=15;break;case 8:return this.q="Disconnecting",this.tt=new Promise((function(t){r.jt=t})),t.next=12,this.et(n);case 12:return t.next=14,this.tt;case 14:t.t1=void t.sent;case 15:t.t0=t.t1;case 16:return t.abrupt("return",t.t0);case 17:case"end":return t.stop()}}),t,this)}))),function(t){return g.apply(this,arguments)})},{key:"et",value:(s=d(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.zt=n,t.prev=1,t.next=4,this.Xt;case 4:t.next=8;break;case 6:t.prev=6,t.t0=t.catch(1);case 8:if(!this.transport){t.next=20;break}return t.prev=9,t.next=12,this.transport.stop();case 12:t.next=17;break;case 14:t.prev=14,t.t1=t.catch(9),this.u.log(e.Error,"HttpConnection.transport.stop() threw error '".concat(t.t1,"'.")),this.Vt();case 17:this.transport=void 0,t.next=21;break;case 20:this.u.log(e.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.");case 21:case"end":return t.stop()}}),t,this,[[1,6],[9,14]])}))),function(t){return s.apply(this,arguments)})},{key:"F",value:(c=d(regeneratorRuntime.mark((function t(n){var r,o,i,c=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.baseUrl,this.St=this.Pt.accessTokenFactory,t.prev=2,!this.Pt.skipNegotiation){t.next=11;break}if(this.Pt.transport===Z.WebSockets){t.next=6;break}throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 6:return this.transport=this.Gt(Z.WebSockets),t.next=9,this.Kt(r,n);case 9:t.next=28;break;case 11:o=null,i=0;case 12:return t.next=14,this.Qt(r);case 14:if(o=t.sent,"Disconnecting"!==this.q&&"Disconnected"!==this.q){t.next=17;break}throw new Error("The connection was stopped during negotiation.");case 17:if(!o.error){t.next=19;break}throw new Error(o.error);case 19:if(!o.ProtocolVersion){t.next=21;break}throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");case 21:o.url&&(r=o.url),o.accessToken&&function(){var t=o.accessToken;c.St=function(){return t}}(),i++;case 23:if(o.url&&i<100){t.next=12;break}case 24:if(100!==i||!o.url){t.next=26;break}throw new Error("Negotiate redirection limit exceeded.");case 26:return t.next=28,this.Yt(r,this.Pt.transport,o,n);case 28:this.transport instanceof ot&&(this.features.inherentKeepAlive=!0),"Connecting"===this.q&&(this.u.log(e.Debug,"The HttpConnection connected successfully."),this.q="Connected"),t.next=34;break;case 31:return t.prev=31,t.t0=t.catch(2),t.abrupt("return",(this.u.log(e.Error,"Failed to start the connection: "+t.t0),this.q="Disconnected",this.transport=void 0,this.jt(),Promise.reject(t.t0)));case 34:case"end":return t.stop()}}),t,this,[[2,31]])}))),function(t){return c.apply(this,arguments)})},{key:"Qt",value:(i=d(regeneratorRuntime.mark((function t(n){var r,i,c,s,u,h,l,f,d,g;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r={},!this.St){t.next=6;break}return t.next=4,this.St();case 4:(i=t.sent)&&(r[nt.Authorization]="Bearer ".concat(i));case 6:return c=L(),s=a(c,2),u=s[0],h=s[1],r[u]=h,l=this.Zt(n),this.u.log(e.Debug,"Sending negotiation request: ".concat(l,".")),t.prev=10,t.next=13,this.$.post(l,{content:"",headers:v(v({},r),this.Pt.headers),timeout:this.Pt.timeout,withCredentials:this.Pt.withCredentials});case 13:if(200===(f=t.sent).statusCode){t.next=16;break}return t.abrupt("return",Promise.reject(new Error("Unexpected status code returned from negotiate '".concat(f.statusCode,"'"))));case 16:return d=JSON.parse(f.content),t.abrupt("return",((!d.negotiateVersion||d.negotiateVersion<1)&&(d.connectionToken=d.connectionId),d));case 20:return t.prev=20,t.t0=t.catch(10),g="Failed to complete negotiation with the server: "+t.t0,t.abrupt("return",(t.t0 instanceof o&&404===t.t0.statusCode&&(g+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this.u.log(e.Error,g),Promise.reject(new p(g))));case 24:case"end":return t.stop()}}),t,this,[[10,20]])}))),function(t){return i.apply(this,arguments)})},{key:"te",value:function(t,e){return e?t+(-1===t.indexOf("?")?"?":"&")+"id=".concat(e):t}},{key:"Yt",value:(r=d(regeneratorRuntime.mark((function t(n,r,o,i){var c,s,a,h,l,d,p,v,g;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=this.te(n,o.connectionToken),!this.ee(r)){t.next=7;break}return this.u.log(e.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=r,t.next=6,this.Kt(c,i);case 6:return t.abrupt("return",void(this.connectionId=o.connectionId));case 7:s=[],a=o.availableTransports||[],h=o,l=u(a),t.prev=10,l.s();case 12:if((d=l.n()).done){t.next=44;break}if(p=d.value,!((v=this.se(p,r,i))instanceof Error)){t.next=19;break}s.push("".concat(p.transport," failed:")),s.push(v),t.next=42;break;case 19:if(!this.ee(v)){t.next=42;break}if(this.transport=v,h){t.next=31;break}return t.prev=21,t.next=24,this.Qt(n);case 24:h=t.sent,t.next=30;break;case 27:return t.prev=27,t.t0=t.catch(21),t.abrupt("return",Promise.reject(t.t0));case 30:c=this.te(n,h.connectionToken);case 31:return t.prev=31,t.next=34,this.Kt(c,i);case 34:return t.abrupt("return",void(this.connectionId=h.connectionId));case 37:if(t.prev=37,t.t1=t.catch(31),this.u.log(e.Error,"Failed to start the transport '".concat(p.transport,"': ").concat(t.t1)),h=void 0,s.push(new f("".concat(p.transport," failed: ").concat(t.t1),Z[p.transport])),"Connecting"===this.q){t.next=42;break}return g="Failed to select transport before stop() was called.",t.abrupt("return",(this.u.log(e.Debug,g),Promise.reject(new Error(g))));case 42:t.next=12;break;case 44:t.next=49;break;case 46:t.prev=46,t.t2=t.catch(10),l.e(t.t2);case 49:return t.prev=49,l.f(),t.finish(49);case 52:return t.abrupt("return",s.length>0?Promise.reject(new b("Unable to connect to the server with any of the available transports. ".concat(s.join(" ")),s)):Promise.reject(new Error("None of the transports supported by the client are supported by the server.")));case 53:case"end":return t.stop()}}),t,this,[[10,46,49,52],[21,27],[31,37]])}))),function(t,e,n,o){return r.apply(this,arguments)})},{key:"Gt",value:function(t){switch(t){case Z.WebSockets:if(!this.Pt.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new ct(this.$,this.St,this.u,this.Pt.logMessageContent,this.Pt.WebSocket,this.Pt.headers||{});case Z.ServerSentEvents:if(!this.Pt.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new it(this.$,this.St,this.u,this.Pt);case Z.LongPolling:return new ot(this.$,this.St,this.u,this.Pt);default:throw new Error("Unknown transport: ".concat(t,"."))}}},{key:"Kt",value:function(t,e){var n=this;return this.transport.onreceive=this.onreceive,this.transport.onclose=function(t){return n.Vt(t)},this.transport.connect(t,e)}},{key:"se",value:function(t,n,r){var o=Z[t.transport];if(null==o)return this.u.log(e.Debug,"Skipping transport '".concat(t.transport,"' because it is not supported by this client.")),new Error("Skipping transport '".concat(t.transport,"' because it is not supported by this client."));if(!function(t,e){return!t||0!=(e&t)}(n,o))return this.u.log(e.Debug,"Skipping transport '".concat(Z[o],"' because it was disabled by the client.")),new l("'".concat(Z[o],"' is disabled by the client."),o);if(!(t.transferFormats.map((function(t){return Y[t]})).indexOf(r)>=0))return this.u.log(e.Debug,"Skipping transport '".concat(Z[o],"' because it does not support the requested transfer format '").concat(Y[r],"'.")),new Error("'".concat(Z[o],"' does not support ").concat(Y[r],"."));if(o===Z.WebSockets&&!this.Pt.WebSocket||o===Z.ServerSentEvents&&!this.Pt.EventSource)return this.u.log(e.Debug,"Skipping transport '".concat(Z[o],"' because it is not supported in your environment.'")),new h("'".concat(Z[o],"' is not supported in your environment."),o);this.u.log(e.Debug,"Selecting transport '".concat(Z[o],"'."));try{return this.Gt(o)}catch(t){return t}}},{key:"ee",value:function(t){return t&&"object"==I(t)&&"connect"in t}},{key:"Vt",value:function(t){var n=this;if(this.u.log(e.Debug,"HttpConnection.stopConnection(".concat(t,") called while in state ").concat(this.q,".")),this.transport=void 0,t=this.zt||t,this.zt=void 0,"Disconnected"!==this.q){if("Connecting"===this.q)throw this.u.log(e.Warning,"Call to HttpConnection.stopConnection(".concat(t,") was ignored because the connection is still in the connecting state.")),new Error("HttpConnection.stopConnection(".concat(t,") was called while the connection is still in the connecting state."));if("Disconnecting"===this.q&&this.jt(),t?this.u.log(e.Error,"Connection disconnected with error '".concat(t,"'.")):this.u.log(e.Information,"Connection disconnected."),this.Jt&&(this.Jt.stop().catch((function(t){n.u.log(e.Error,"TransportSendQueue.stop() threw error '".concat(t,"'."))})),this.Jt=void 0),this.connectionId=void 0,this.q="Disconnected",this.M){this.M=!1;try{this.onclose&&this.onclose(t)}catch(n){this.u.log(e.Error,"HttpConnection.onclose(".concat(t,") threw error '").concat(n,"'."))}}}else this.u.log(e.Debug,"Call to HttpConnection.stopConnection(".concat(t,") was ignored because the connection is already in the disconnected state."))}},{key:"Bt",value:function(t){if(0===t.lastIndexOf("https://",0)||0===t.lastIndexOf("http://",0))return t;if(!O.isBrowser||!window.document)throw new Error("Cannot resolve '".concat(t,"'."));var n=window.document.createElement("a");return n.href=t,this.u.log(e.Information,"Normalizing '".concat(t,"' to '").concat(n.href,"'.")),n.href}},{key:"Zt",value:function(t){var e=t.indexOf("?"),n=t.substring(0,-1===e?t.length:e);return"/"!==n[n.length-1]&&(n+="/"),n+="negotiate",-1===(n+=-1===e?"":t.substring(e)).indexOf("negotiateVersion")&&(n+=-1===e?"?":"&",n+="negotiateVersion="+this.Ft),n}}]),t}(),at=function(){function t(e){m(this,t),this.ne=e,this.ie=[],this.re=!0,this.oe=new ut,this.he=new ut,this.ce=this.ae()}var e;return y(t,[{key:"send",value:function(t){return this.le(t),this.he||(this.he=new ut),this.he.promise}},{key:"stop",value:function(){return this.re=!1,this.oe.resolve(),this.ce}},{key:"le",value:function(t){if(this.ie.length&&I(this.ie[0])!=I(t))throw new Error("Expected data to be of type ".concat(I(this.ie)," but was of type ").concat(I(t)));this.ie.push(t),this.oe.resolve()}},{key:"ae",value:(e=d(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.oe.promise;case 2:if(this.re){e.next=5;break}return this.he&&this.he.reject("Connection stopped."),e.abrupt("break",21);case 5:return this.oe=new ut,n=this.he,this.he=void 0,r="string"==typeof this.ie[0]?this.ie.join(""):t.ue(this.ie),this.ie.length=0,e.prev=10,e.next=13,this.ne.send(r);case 13:n.resolve(),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(10),n.reject(e.t0);case 19:e.next=0;break;case 21:case"end":return e.stop()}}),e,this,[[10,16]])}))),function(){return e.apply(this,arguments)})}],[{key:"ue",value:function(t){var e,n=t.map((function(t){return t.byteLength})).reduce((function(t,e){return t+e})),r=new Uint8Array(n),o=0,i=u(t);try{for(i.s();!(e=i.n()).done;){var c=e.value;r.set(new Uint8Array(c),o),o+=c.byteLength}}catch(t){i.e(t)}finally{i.f()}return r.buffer}}]),t}(),ut=function(){function t(){var e=this;m(this,t),this.promise=new Promise((function(t,n){var r;return r=[t,n],e.de=r[0],e.fe=r[1],r}))}return y(t,[{key:"resolve",value:function(){this.de()}},{key:"reject",value:function(t){this.fe(t)}}]),t}(),ht=function(){function t(){m(this,t),this.name="json",this.version=1,this.transferFormat=Y.Text}return y(t,[{key:"parseMessages",value:function(t,n){if("string"!=typeof t)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!t)return[];null===n&&(n=x.instance);var r,o=[],i=u(K.parse(t));try{for(i.s();!(r=i.n()).done;){var c=r.value,s=JSON.parse(c);if("number"!=typeof s.type)throw new Error("Invalid payload.");switch(s.type){case J.Invocation:this.pe(s);break;case J.StreamItem:this.we(s);break;case J.Completion:this.ge(s);break;case J.Ping:case J.Close:break;default:n.log(e.Information,"Unknown message type '"+s.type+"' ignored.");continue}o.push(s)}}catch(t){i.e(t)}finally{i.f()}return o}},{key:"writeMessage",value:function(t){return K.write(JSON.stringify(t))}},{key:"pe",value:function(t){this.me(t.target,"Invalid payload for Invocation message."),void 0!==t.invocationId&&this.me(t.invocationId,"Invalid payload for Invocation message.")}},{key:"we",value:function(t){if(this.me(t.invocationId,"Invalid payload for StreamItem message."),void 0===t.item)throw new Error("Invalid payload for StreamItem message.")}},{key:"ge",value:function(t){if(t.result&&t.error)throw new Error("Invalid payload for Completion message.");!t.result&&t.error&&this.me(t.error,"Invalid payload for Completion message."),this.me(t.invocationId,"Invalid payload for Completion message.")}},{key:"me",value:function(t,e){if("string"!=typeof t||""===t)throw new Error(e)}}]),t}(),lt={trace:e.Trace,debug:e.Debug,info:e.Information,information:e.Information,warn:e.Warning,warning:e.Warning,error:e.Error,critical:e.Critical,none:e.None},ft=function(){function t(){m(this,t)}return y(t,[{key:"configureLogging",value:function(t){if(P.isRequired(t,"logging"),void 0!==t.log)this.logger=t;else if("string"==typeof t){var e=function(t){var e=lt[t.toLowerCase()];if(void 0!==e)return e;throw new Error("Unknown log level: ".concat(t))}(t);this.logger=new q(e)}else this.logger=new q(t);return this}},{key:"withUrl",value:function(t,e){return P.isRequired(t,"url"),P.isNotEmpty(t,"url"),this.url=t,this.httpConnectionOptions="object"==I(e)?v(v({},this.httpConnectionOptions),e):v(v({},this.httpConnectionOptions),{},{transport:e}),this}},{key:"withHubProtocol",value:function(t){return P.isRequired(t,"protocol"),this.protocol=t,this}},{key:"withAutomaticReconnect",value:function(t){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return t?Array.isArray(t)?this.reconnectPolicy=new et(t):this.reconnectPolicy=t:this.reconnectPolicy=new et,this}},{key:"build",value:function(){var t=this.httpConnectionOptions||{};if(void 0===t.logger&&(t.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");var e=new st(this.url,t);return Q.create(e,this.logger||x.instance,this.protocol||new ht,this.reconnectPolicy)}}]),t}();return Uint8Array.prototype.indexOf||Object.defineProperty(Uint8Array.prototype,"indexOf",{value:Array.prototype.indexOf,writable:!0}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(t,e){return new Uint8Array(Array.prototype.slice.call(this,t,e))},writable:!0}),Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach,writable:!0}),r}()},"object"==I(e)&&"object"==I(t)?t.exports=c():(o=[],void 0===(i="function"==typeof(r=c)?r.apply(e,o):r)||(t.exports=i))},26:function(t){"use strict";t.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={id:r,loaded:!1,exports:{}};return t[r](i,i.exports,n),i.loaded=!0,i.exports}return n.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t},n(91)}()}));